<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.css">
   
</head>

<body>
    <div class="wrapper">
        <div class="user-container">
            <label for="nickname">대화명</label>
            <input type="text" id="nickname">

        </div>
        <div class="display-container">
            <ul class="chatting-list">

            </ul>
        </div>
        <div class="input-container">
            <span>
                <input type="text" class="chatting-input">
                <button class="send-button">전송</button>
            </span>

        </div>
    </div>
   
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io('/chat');

        const nickname = document.querySelector('#nickname')
        const chatlist = document.querySelector('.chatting-list')
        const chatInput = document.querySelector('.chatting-input')
        const sendButton = document.querySelector('.send-button')
        const displayContainer = document.querySelector('.display-container')

        chatInput.addEventListener('keypress', (event) => {
            if (event.keyCode === 13) {
                send()
            }

        })

        function send() {
            const param = {
                name: nickname.value,
                msg: chatInput.value
            }
            socket.emit('chatting', param)
        }
        sendButton.addEventListener('click', send)


        socket.on('chatting', (data) => {
            console.log(data)
            const { name, msg, time } = data;
            const item = new LiModel(name, msg, time); // li 를 초기화
            item.makeLi()
            displayContainer.scrollTo(0, displayContainer.scrollHeight)
        })

        function LiModel(name, msg, time) {
            this.name = name;
            this.msg = msg;
            this.time = time;

            this.makeLi = () => {
                const li = document.createElement('li');
                li.classList.add(nickname.value === this.name ? "sent" : "received")
                const dom = ` <span class="profile">
            <span class="user">${this.name}</span>
            <img class="image" src="https://placeimg.com/50/50/any" alt="any">
        </span>
        <span class ='message'>${this.msg}</span>
        <span class ='time'>${this.time}</span>`;
                li.innerHTML = dom;
                chatlist.appendChild(li)
            }
        }
    </script>
</body>

</html>